openapi: 3.0.3
info:
  title: ERP Distribution - API Gateway
  version: 1.0.0
  description: |
    Specification OpenAPI centralisee exposee via l'API Gateway.
    Les clients consomment principalement ces routes /api/v1/*.

servers:
  - url: http://localhost:4000
    description: API Gateway locale

tags:
  - name: Gateway Auth
  - name: Sales
  - name: Catalog
  - name: Suppliers
  - name: Customers

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    cookieAuth:
      type: apiKey
      in: cookie
      name: erp_session

paths:
  /health:
    get:
      summary: Healthcheck du gateway
      tags: [Gateway Auth]
      responses:
        '200':
          description: OK

  /api/v1/auth/login:
    post:
      summary: Login admin (auth simple locale)
      tags: [Gateway Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
              required: [username, password]
      responses:
        '200':
          description: JWT genere + cookie session HTTP-only
        '401':
          description: Identifiants invalides

  /api/v1/auth/logout:
    post:
      summary: Logout session
      tags: [Gateway Auth]
      responses:
        '200':
          description: Cookie de session supprime

  /api/v1/auth/me:
    get:
      summary: Infos du token courant
      tags: [Gateway Auth]
      security:
        - bearerAuth: []
        - cookieAuth: []
      responses:
        '200':
          description: Payload token
        '401':
          description: Non authentifie

  /api/v1/sales/orders:
    get:
      summary: Lister les commandes (via gateway)
      tags: [Sales]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Liste des commandes
    post:
      summary: Creer une commande (via gateway)
      tags: [Sales]
      security:
        - bearerAuth: []
        - cookieAuth: []
      responses:
        '201':
          description: Commande creee

  /api/v1/sales/orders/{orderId}:
    get:
      summary: Detail commande (via gateway)
      tags: [Sales]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail commande
        '404':
          description: Non trouve

  /api/v1/catalog/products:
    get:
      summary: Lister les produits (via gateway)
      tags: [Catalog]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: category
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Liste des produits

  /api/v1/catalog/products/{productId}:
    get:
      summary: Detail produit (via gateway)
      tags: [Catalog]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail produit
        '404':
          description: Non trouve

  /api/v1/catalog/products/{productId}/stock:
    patch:
      summary: Mettre a jour le stock (via gateway)
      tags: [Catalog]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Stock mis a jour

  /api/v1/suppliers:
    get:
      summary: Lister les fournisseurs (via gateway)
      tags: [Suppliers]
      security:
        - bearerAuth: []
        - cookieAuth: []
      responses:
        '200':
          description: Liste fournisseurs

  /api/v1/suppliers/{supplierId}:
    get:
      summary: Detail fournisseur (via gateway)
      tags: [Suppliers]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: supplierId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail fournisseur
        '404':
          description: Non trouve
    patch:
      summary: Mettre a jour un fournisseur (via gateway)
      tags: [Suppliers]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: supplierId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fournisseur mis a jour

  /api/v1/customers:
    get:
      summary: Lister les clients (via gateway)
      tags: [Customers]
      security:
        - bearerAuth: []
        - cookieAuth: []
      responses:
        '200':
          description: Liste clients
    post:
      summary: Creer un client (via gateway)
      tags: [Customers]
      security:
        - bearerAuth: []
        - cookieAuth: []
      responses:
        '201':
          description: Client cree

  /api/v1/customers/{customerId}:
    get:
      summary: Detail client (via gateway)
      tags: [Customers]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail client
        '404':
          description: Non trouve
    patch:
      summary: Mettre a jour un client (via gateway)
      tags: [Customers]
      security:
        - bearerAuth: []
        - cookieAuth: []
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Client mis a jour
